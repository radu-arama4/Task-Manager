package com.stefanini.taskmanager.persistence.daoImpl;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import com.stefanini.taskmanager.dto.Task;
import com.stefanini.taskmanager.dto.User;
import com.stefanini.taskmanager.persistence.dao.TaskDao;
import com.stefanini.taskmanager.persistence.util.DButil;

public class TaskDaoImpl implements TaskDao{

	Connection connection = DButil.connectToDb();
	
	@Override
	public boolean addTask(Task task, User user) {
		try {
            String userName = user.getUserName();
            String taskTitle = task.getTaskTitle();
            String taskDescription = task.getDescription();

            String query = "INSERT INTO task(Task_Title,Description,userName) " +
                    "VALUES('" + taskTitle + "','"+ taskDescription +"','" + userName + "')";

            Statement statement = connection.createStatement();
            statement.executeUpdate(query);
            return true;
        } catch (SQLException e) {
            e.printStackTrace();
            return false;
        }
	}

	@Override
	public List<Task> showTasks() throws SQLException {
		final String query = "SELECT * FROM task";
        Statement statement = connection.createStatement();
        ResultSet rs = statement.executeQuery(query);
        
        List<Task> tasks = new ArrayList<Task>();
        
        while (rs.next()){
            String taskTitle = rs.getString("Task_Title");
            String description = rs.getString("Description");

            tasks.add(new Task(taskTitle, description));
    
        }
        rs.close();
        return tasks;
	}

}
